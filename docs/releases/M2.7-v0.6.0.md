# FlowTime-Sim M2.7-v0.6.0 Release Notes

**Release Date**: October 3, 2025  
**Version**: 0.6.0  
**Milestone**: SIM-M2.7 ‚Äî Model Provenance Integration  
**Type**: Minor Release (additive feature)  
**Git Tag**: `v0.6.0` (pending merge)  
**Branch**: `feature/core-m2.7/provenance-integration`

## Overview

This release implements complete provenance traceability for FlowTime-Sim generated models. Every model now has a unique identity and carries metadata about its creation‚Äîwhich template generated it, what parameters were used, and when it was created. This enables end-to-end traceability from template ‚Üí model ‚Üí execution run.

**Architecture**: Sim generates models + provenance (stateless), Engine stores everything (single source of truth), UI orchestrates the workflow.

## üöÄ What's New

### Provenance Metadata Generation

Every generated model now includes provenance metadata:

```json
{
  "source": "flowtime-sim",
  "modelId": "model_20251003T120000Z_abc123de",
  "templateId": "it-system-microservices",
  "templateVersion": "1.0",
  "templateTitle": "IT System - Microservices",
  "generatedAt": "2025-10-03T12:00:00Z",
  "generator": "flowtime-sim/0.6.0",
  "schemaVersion": "1",
  "parameters": {
    "bins": 12,
    "binSize": 1,
    "binUnit": "hours",
    "loadBalancerCapacity": 300
  }
}
```

**Key Features**:
- **Unique Model IDs**: Format `model_{timestamp}_{hash}` ensures global uniqueness
- **Deterministic Hashing**: Same template + parameters = reproducible hash portion
- **Complete Lineage**: Track every model back to its source template and parameters
- **Reproducibility**: Exact parameter values captured for model recreation

### Enhanced API Endpoint

`POST /api/v1/templates/{id}/generate` now returns both model and provenance:

```json
{
  "model": "schemaVersion: 1\n...",
  "provenance": { ... }
}
```

**Query Parameters**:
- `?embed_provenance=true` - Embed provenance directly in model YAML (self-contained files)
- Default (false) - Return provenance separately for header-based delivery

### CLI Provenance Support

Two new CLI flags for flexible provenance workflows:

**Separate File Output**:
```bash
flowtime-sim generate --template it-system --params bins=12 \
  --output model.yaml --provenance provenance.json
```

**Embedded Provenance**:
```bash
flowtime-sim generate --template it-system --params bins=12 \
  --output model.yaml --embed-provenance
```

Embedded format places provenance section in YAML after `schemaVersion`:

```yaml
schemaVersion: 1

provenance:
  source: flowtime-sim
  modelId: model_20251003T120000Z_abc123de
  templateId: it-system-microservices
  # ... rest of provenance

grid:
  bins: 12
  # ... model specification
```

### Engine Integration

Validated end-to-end integration with FlowTime Engine (M2.9):

- **X-Model-Provenance Header**: Engine accepts provenance via HTTP header
- **Artifact Storage**: Engine stores `provenance.json` in run artifacts (`/data/run_*/`)
- **Embedded Support**: Engine extracts provenance from embedded YAML
- **Registry Integration**: Provenance metadata included in Engine's artifact registry
- **Query Support**: Filter runs by `templateId`, `modelId`, or `source=flowtime-sim`

## üîß Technical Implementation

### Core Components

- **ProvenanceService**: Generates unique model IDs and provenance metadata
  - Model ID algorithm: `model_{ISO8601_timestamp}_{SHA256_hash[0:8]}`
  - Hash input: `{templateId}:{parametersJson}` for determinism
  - Captures template metadata, parameters, timestamps, generator version

- **ProvenanceEmbedder**: Embeds provenance in YAML models
  - Correct placement: after `schemaVersion`, before `grid`
  - CamelCase field names for JSON/YAML consistency
  - Preserves model structure and formatting

- **ModelGenerator Enhancement**: Integrated provenance generation into model workflow
  - Non-intrusive: doesn't affect model generation logic
  - Flexible: supports both separate and embedded modes
  - Backward compatible: provenance is optional

### API Changes

**Enhanced Response Schema**:
```json
{
  "model": "string (YAML)",
  "provenance": {
    "source": "string",
    "modelId": "string",
    "templateId": "string",
    "templateVersion": "string",
    "templateTitle": "string",
    "generatedAt": "ISO8601 timestamp",
    "generator": "string",
    "schemaVersion": "string",
    "parameters": {}
  }
}
```

**New Query Parameter**: `?embed_provenance=true`

### CLI Changes

**New Flags**:
- `--provenance <file>`: Save provenance metadata to separate file
- `--embed-provenance`: Embed provenance in model YAML

**Mutual Exclusivity**: Cannot use both flags together (separate vs. embedded choice)

## üõ†Ô∏è Breaking Changes

**None** - This is a fully additive release:
- Existing API calls continue to work (can ignore provenance field)
- Provenance is optional (models work with or without it)
- CLI maintains backward compatibility (new flags are optional)
- Version bump: 0.5.0 ‚Üí 0.6.0 (minor version for new feature)

## üß™ Testing

### Test Coverage

- **Unit Tests**: 128 tests passing (Sim-side)
  - ProvenanceService tests (model ID generation, determinism)
  - ProvenanceEmbedder tests (YAML embedding)
  - ModelGenerator tests (provenance integration)
  - API endpoint tests (both modes)
  - CLI tests (both flags)

- **Integration Tests**: 4/4 tests passing (Sim ‚Üî Engine)
  - ‚úÖ Basic workflow (generation ‚Üí execution)
  - ‚úÖ Provenance storage (Engine stores provenance.json)
  - ‚úÖ Optional provenance (backward compatibility)
  - ‚úÖ Old schema rejection (validation of breaking changes)

### Test Infrastructure

New comprehensive integration test suite:
- **Automated Script**: `scripts/test-sim-engine-integration.sh`
  - 4 test scenarios across 2 chapters
  - Color-coded output, verbose mode, chapter selection
  - CI/CD ready
  
- **Manual HTTP Tests**: `docs/testing/sim-engine-integration-manual.http`
  - 30+ HTTP requests covering 6 chapters
  - VS Code REST Client format for interactive testing
  
- **Documentation**: `docs/testing/sim-engine-integration-summary.md`
  - Complete testing philosophy and procedures
  - Troubleshooting guide
  - Results tracking

## üìä Validation Results

### Integration Test Results (October 3, 2025)

**Chapter 1: Basic Workflow**
- ‚úÖ PASS: Basic workflow: generation ‚Üí execution (all response fields present)

**Chapter 4: Provenance Metadata**
- ‚úÖ PASS: Header-based provenance stored
- ‚úÖ PASS: Models without provenance metadata work (optional feature)
- ‚úÖ PASS: Old schema (arrivals/route) correctly REJECTED

**Total**: 4 tests, Passed: 4, Failed: 0

### End-to-End Validation

- ‚úÖ Sim generates models with provenance metadata
- ‚úÖ Engine accepts X-Model-Provenance header
- ‚úÖ Engine stores provenance.json in run artifacts
- ‚úÖ Embedded provenance correctly extracted by Engine
- ‚úÖ All Engine response fields validated (grid, order, series, runId, artifactsPath, modelHash)
- ‚úÖ Old schema (arrivals/route) correctly rejected with HTTP 400
- ‚úÖ Provenance is optional (backward compatibility maintained)

## üìã Architecture & Design

### KISS Architecture Principles

**Service Separation**:
- **Sim**: Generates models + provenance (stateless, no persistent storage)
- **Engine**: Executes models + stores everything (single source of truth)
- **UI**: Orchestrates workflow (calls Sim ‚Üí sends to Engine)

**Critical Rule**: Sim and Engine do not communicate directly. UI is the orchestrator.

### Provenance Flow

```
Template + Parameters
    ‚Üì
Sim generates Model + Provenance
    ‚Üì
UI receives both
    ‚Üì
UI sends to Engine (header or embedded)
    ‚Üì
Engine executes and stores both
    ‚Üì
Engine registry includes provenance metadata
    ‚Üì
UI queries Engine registry (filter by templateId, modelId, source)
```

### Benefits

- **Zero Sim Storage**: Stateless design maintained (no database, no persistence)
- **Single Source of Truth**: Engine registry is authoritative
- **Complete Traceability**: Every run traceable to source template
- **Reproducibility**: Exact parameters captured for model recreation
- **Query Capabilities**: Filter runs by template, model, or generator source
- **Backward Compatible**: Optional feature, doesn't break existing workflows

## üîÑ Migration Guide

**No migration required** - existing code continues to work unchanged.

### For API Consumers

**Old behavior (still works)**:
```bash
POST /api/v1/templates/it-system/generate
# Returns: { "model": "..." }
```

**New behavior (with provenance)**:
```bash
POST /api/v1/templates/it-system/generate
# Returns: { "model": "...", "provenance": {...} }
```

Simply ignore the `provenance` field if you don't need it, or use it to pass to Engine via X-Model-Provenance header.

### For CLI Users

**Old behavior (still works)**:
```bash
flowtime-sim generate --template it-system --output model.yaml
# Generates model.yaml only
```

**New options (optional)**:
```bash
# Save provenance separately
flowtime-sim generate --template it-system --output model.yaml --provenance provenance.json

# Embed provenance in model
flowtime-sim generate --template it-system --output model.yaml --embed-provenance
```

### For Template Authors

No changes required. All existing templates work with provenance automatically. The metadata you already define (templateId, title, version) is captured in provenance.

## üéØ What's Next

### Immediate: v1.0.0 Stable Release

After merging SIM-M2.7, the core workflow is complete:
- Template generation ‚úÖ
- Provenance tracking ‚úÖ
- Engine integration ‚úÖ
- End-to-end validation ‚úÖ

Next milestone focuses on stability:
- API contract documentation
- Backward compatibility policy
- Production-ready defaults
- Complete user documentation

### Future Enhancements (Post-v1.0.0)

Features to add **only as needed** based on actual usage:
- Enhanced validation (if users struggle with errors)
- Additional template domains (supply chain, healthcare, network)
- Template versioning (if evolution becomes complex)
- Model comparison helpers (if users need comparison)
- Performance optimizations (if generation becomes slow)

**Philosophy**: Ship stable foundation first, add features incrementally based on real user demand.

## üìö Documentation

### New Documentation

- **Integration Tests**: Complete test suite with automated script and manual HTTP tests
- **Engine Spec**: `docs/reference/engine-m2.9-provenance-spec.md` documents the provenance contract
- **Testing Guide**: `docs/testing/sim-engine-integration-summary.md` for integration testing

### Updated Documentation

- **Milestone**: `docs/milestones/SIM-M2.7.md` marked complete with results
- **Roadmap**: `docs/ROADMAP.md` updated (renamed from NEW-ROADMAP.md)
  - v0.6.0 marked as current version
  - SIM-M2.6.1 and SIM-M2.7 moved to completed milestones
  - Next milestone: v1.0.0 stable release

## üôè Acknowledgments

**Engine Coordination**: This release required close coordination with FlowTime Engine M2.9 implementation for provenance acceptance and storage.

**Integration Validation**: End-to-end testing validated the complete Sim ‚Üî Engine workflow.

---

**Contributors**: GitHub Copilot  
**Final Commit**: `5610984` (docs) + `949149f` (integration tests)  
**Previous Version**: v0.5.0 (SIM-M2.6.1 Schema Evolution)  
**Branch**: `feature/core-m2.7/provenance-integration`  
**Status**: Ready for merge to milestone branch

---

## Related Documents

- [SIM-M2.7 Milestone](../milestones/SIM-M2.7.md)
- [Roadmap](../ROADMAP.md)
- [Engine Provenance Spec](../reference/engine-m2.9-provenance-spec.md)
- [Integration Test Suite](../testing/sim-engine-integration-summary.md)

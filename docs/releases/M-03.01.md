# M-03.01 Time-Travel State APIs â€“ Release Summary

**Milestone:** M-03.01 â€” Time-Travel State APIs  
**Status:** âœ… Complete  
**Date:** October 19, 2025  
**Branch:** `time-travel-m3`

---

## ðŸŽ¯ Milestone Outcome

FlowTime Engine now exposes production-ready `/state` and `/state_window` endpoints backed by canonical run artifacts, mode-aware validation, and schema-validated responses. Observability and documentation refinements ensure UI and downstream tooling can rely on stable contracts for time-travel analysis.

## âœ… Completed Features

### Time-Travel API Contracts
- Implemented `/v1/runs/{runId}/state` (single-bin snapshot) and `/v1/runs/{runId}/state_window` (multi-bin slice) returning:
  - Metadata envelope (runId, template id/title/version, mode, provenance hash, storage paths)
  - Bin/window details with UTC timestamps derived from the canonical grid
  - Per-node raw metrics and derived values (utilisation, latency, throughput ratio, colour)
  - Aggregated warnings surfaced from mode validation and telemetry fallback paths
- Added golden snapshots for both responses to lock payload shape.

### Mode Awareness & Observability
- Centralised mode validation (`ModeValidator`) to differentiate telemetry warnings from simulation errors, including provenance mismatch detection.
- Structured logging (EventIds 3001/3002) records runId, mode, and bin/window request parameters for `/state` and `/state_window`.
- Integration tests assert the observability payload using a lightweight log collector.

### Canonical Artifact Persistence
- `RunArtifactWriter` now emits SIM-aligned bundles:
  - `model/model.yaml`, synthesised `metadata.json`, and `provenance.json`
  - `series/index.json` and per-series CSV files with wildcard (`*`, `prefix/*`) expansion
  - Consistent SHA-256 `modelHash` recorded across `run.json`, `manifest.json`, and metadata
- `.http` samples updated to reflect the enriched metadata envelope and canonical series identifiers.

### Schema & Documentation
- Published `docs/schemas/time-travel-state.schema.json` describing `/state` and `/state_window` payloads.
- Added `StateResponseSchemaTests` to validate live responses against the schema.
- Documented the schema in `docs/schemas/README.md` and captured milestone completion in tracking docs and the time-travel roadmap.

## ðŸ“Š Validation

| Command | Notes |
|---------|-------|
| `dotnet test tests/FlowTime.Api.Tests --logger "console;verbosity=minimal"` | Verifies API integration tests, log assertions, schema validation |
| `dotnet test tests/FlowTime.Tests --logger "console;verbosity=minimal"` | Confirms artefact writer and shared logic regressions |

Manual smoke: `.http` walkthrough exercises run creation, `/state`, `/state_window`, and raw series download using engine-produced canonical artifacts.

## ðŸš€ Next Steps

- Kick off **M-03.02 TelemetryLoader + Templates** to consume real telemetry sources and instantiate templates with the new canonical storage structure.
- Coordinate with UI milestone (UI-M-03.x) to integrate the enriched metadata envelope and logging fields.

---

**M-03.01 is complete â€“ time-travel state APIs are ready for downstream consumers.**

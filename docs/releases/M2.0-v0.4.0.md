# FlowTime M2.0 Release (v0.4.0)

> **üìã Charter Notice**: This release predates the [FlowTime-Engine Charter](../flowtime-engine-charter.md). PMF capabilities delivered here remain core to the charter execution engine and support the artifacts-centric workflow.

**Release Date:** September 11, 2025  
**Branch:** `feature/M2-pmf-support` ‚Üí `main`  
**Milestone:** M2.0 - PMF Support Complete *(Pre-Charter)*  
**Version:** v0.4.0

---

## üéØ Milestone Overview

FlowTime M2.0 (v0.4.0) completes **Milestone M2 - PMF Support**, introducing Probability Mass Function (PMF) nodes that enable uncertainty modeling in business workflows. This release transforms discrete probability distributions into deterministic expected values, enabling fast "what-if" analysis without Monte Carlo simulation overhead.

**Key Innovation:** Convert uncertainty into explainable expected values while maintaining FlowTime's deterministic evaluation philosophy.

---

## ‚ú® New Features

### PMF Node Support
- **PMF Nodes**: New `pmf` node kind for discrete probability distributions
- **Expected Value Calculation**: Automatic conversion of PMF distributions to deterministic expected values
- **YAML Integration**: Native PMF specification in model definitions
- **Expression Language Integration**: PMF nodes work seamlessly with operators and functions

### Core PMF Capabilities
```yaml
# Simple PMF example
customer_attempts:
  kind: pmf
  pmf:
    "1": 0.5    # 50% single attempt
    "2": 0.3    # 30% double attempt  
    "3": 0.2    # 20% triple attempt
  # Expected value: 1.7 attempts

# PMF in expressions
load_estimate:
  kind: expr
  expr: "customer_attempts * surge_factor"
```

### Validation & Error Handling
- **Probability Validation**: Automatic normalization and validation of PMF distributions
- **Clear Error Messages**: Actionable feedback for malformed PMF specifications
- **Tolerance Handling**: Graceful handling of rounding errors in probability sums

---

## üîß Technical Improvements

### Performance Infrastructure
- **Benchmark Reorganization**: M15‚ÜíM16 naming to reflect actual milestone capabilities
- **M2 Performance Testing**: Comprehensive PMF vs baseline performance validation
- **Legacy Test Adjustments**: Relaxed thresholds for development container environments

### Architecture Enhancements
- **Core PMF Classes**: `Pmf`, `PmfNode` with robust validation
- **Parser Extensions**: ModelParser enhanced for PMF node specification
- **CLI/API Parity**: Identical PMF support across all interfaces

---

## üìä Performance Analysis

### PMF Performance Characteristics
- **Parse Overhead**: 15-20x slower than const nodes (acceptable for modeling use case)
- **Evaluation Performance**: PMF evaluation often **faster** than const nodes
- **Memory Usage**: <6% overhead vs constant nodes
- **Scale Testing**: Verified performance up to 1000+ nodes

### Real-World Readiness
- **1100 Node Models**: ~440-480ms total processing time
- **Memory Footprint**: <12MB for large models
- **UI Responsiveness**: Sub-500ms performance suitable for interactive modeling

---

## üß™ Testing & Quality

### Comprehensive Test Coverage
- **Unit Tests**: >95% coverage for PMF functionality
- **Integration Tests**: CLI/API parity validation
- **Performance Tests**: PMF vs baseline benchmarking
- **Contract Tests**: FlowTime-Sim compatibility validated

### Test Categories
- **PMF Validation**: Probability normalization, error handling
- **Expression Integration**: PMF nodes in complex expressions
- **Artifact Generation**: Standard FlowTime output format compatibility
- **End-to-End Workflows**: Complete model execution validation

---

## üìà Business Value

### Uncertainty Modeling
- **Risk Analysis**: Model uncertain parameters with discrete probability distributions
- **Scenario Planning**: "What-if" analysis with probabilistic inputs
- **Decision Support**: Expected value calculations for business planning

### Typical Use Cases
```yaml
# Support ticket volume with uncertainty
support_tickets:
  kind: pmf
  pmf: { "0": 0.1, "1": 0.3, "2": 0.3, "3": 0.2, "4": 0.1 }
  # Expected: 1.9 tickets/hour

# API request load with surge probability  
api_requests:
  kind: pmf
  pmf: { "100": 0.7, "150": 0.2, "200": 0.1 }
  # Expected: 120 requests/hour
```

---

## üîÑ Migration Guide

### Backward Compatibility
- **No Breaking Changes**: All existing M0/M1/M1.5 models continue to work
- **Additive Features**: PMF nodes are purely additive functionality
- **Schema Compatibility**: No changes to artifact format or structure

### Upgrading to M2.0 (v0.4.0)
1. **Update FlowTime**: No model changes required for existing workflows
2. **Explore PMFs**: Add PMF nodes to model uncertain parameters
3. **Performance Testing**: Validate performance for your specific model sizes

---

## üîó Related Documentation

- **PMF Modeling Guide**: `docs/concepts/pmf-modeling.md`
- **M2 Milestone Documentation**: `docs/milestones/M2.md`
- **Performance Testing**: `tests/FlowTime.Tests/Benchmarks/README.md`
- **API Documentation**: CLI and API PMF examples included

---

## üèóÔ∏è Implementation Details

### Core Components
- **`src/FlowTime.Core/Pmf/`**: PMF data structures and validation
- **`src/FlowTime.Core/Models/ModelParser.cs`**: PMF node parsing
- **Performance Tests**: M2 PMF benchmarking and validation

### Version Updates
- **All Projects**: Updated to v0.4.0 across solution  
- **Consistent Versioning**: All components share same version number  
- **Milestone Completion**: M2.0 represents completion of M2 PMF Support milestone

---

## üéØ What's Next

### Future PMF Enhancements (M15+)
- **Distribution Propagation**: Full statistical distribution tracking
- **Convolution Operations**: CONV() function for distribution arithmetic
- **Monte Carlo Sampling**: Optional simulation modes for complex scenarios

### UI Development Ready
- **Performance Validated**: System ready for 1100+ node interactive modeling
- **UI Foundation**: Template system prepared for PMF parameter editors
- **Visualization Ready**: PMF distribution charting capabilities

---

## üôè Acknowledgments

This release completes the M2 PMF Support milestone with comprehensive testing, documentation, and performance validation. The implementation provides a solid foundation for uncertainty modeling while maintaining FlowTime's deterministic evaluation philosophy.

**Ready for Production**: Performance analysis confirms readiness for real-world PMF modeling workflows.

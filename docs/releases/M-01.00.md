# Release Notes — M-1 (Contracts Parity)

Date: 2025-09-01

## Summary
- Locks core run artifact contract in parity with FlowTime-Sim
- Introduces dual-write structured artifacts (run + manifest + index)
- Adds JSON Schema validation for artifact consistency
- Enables cross-project compatibility and future UI/adapter work
- Maintains backward compatibility while establishing new contract foundation

## Artifacts
- Enhanced CLI: Dual-write artifact directories
- Schemas: `docs/schemas/` for validation
- Core: Enhanced hashing and determinism
- Tests: Contract validation and determinism tests

## Usage
- Build: `dotnet build`
- Test: `dotnet test`
- Run: `dotnet run --project src/FlowTime.Cli -- run examples/hello/model.yaml --out out/hello`
- Output: Structured directory with run.json, manifest.json, series/index.json, CSV files

## Directory Layout
```
out/<runId>/
  spec.yaml                     # original model (persisted for overlays)
  run.json                      # high-level summary + series listing
  manifest.json                 # determinism + integrity metadata  
  series/
    index.json                  # series discovery with units
    <seriesId>.csv              # per-series CSV files
  aggregates/                   # placeholder for future Parquet
  events.ndjson                 # placeholder for future events
```

## Changes
- New: Dual-write artifact directories with structured JSON
- New: Enhanced `run.json` with source="engine", engineVersion, grid metadata
- New: `manifest.json` with scenarioHash, RNG info, seriesHashes, integrity
- New: `series/index.json` with per-series metadata, units, component mapping
- New: SeriesId naming convention: `measure@componentId[@class]`
- New: Enhanced deterministic hashing with full YAML normalization
- New: JSON Schema validation under `docs/schemas/`
- New: CLI flags: `--no-manifest`, `--deterministic-run-id`
- Enhanced: InvariantCulture formatting for cross-platform determinism
- Enhanced: Per-series CSV files with `t,value` schema

## Contract Compliance
✅ **Schema Version 1** - Full contracts.md v1.0 implementation  
✅ **FlowTime-Sim Parity** - Compatible artifact shapes  
✅ **Deterministic Hashing** - Reproducible across environments  
✅ **Schema Validation** - CI-validated against JSON schemas  
✅ **Backward Compatibility** - Existing workflows preserved  

## Key Features
- **Artifact-First Design** - JSON artifacts are authoritative
- **Cross-Project Compatibility** - Same format as FlowTime-Sim
- **Future-Proof Placeholders** - Reserved fields for events, aggregates tables
- **Deterministic Output** - Hash-stable across OS/culture differences
- **Graceful Schema Evolution** - Version-aware readers supported

## API Integration
- API endpoints produce identical artifact structure
- CLI ↔ API parity maintained via shared Core evaluation
- Contract tests ensure no drift between implementations

## Acceptance Criteria Met
✅ Dual-write directory with all JSON files and CSV series  
✅ JSON Schemas validate in CI  
✅ Simulator vs engine artifact parity tests pass  
✅ Hash stability across YAML key reordering  
✅ `--no-manifest` suppresses manifest.json only  
✅ All prior tests remain green  

## Compatibility
- Target: .NET 9.0
- Breaking: Artifact output format (dual-write vs single CSV)
- Compatible: All model YAML schemas unchanged
- Forward: Schema version enables future evolution

## Next
- SYN-M-00.00: File adapter to read these artifacts
- SVC-M-1: API artifact endpoints  
- UI integration: Consume structured artifacts for visualization

# M-03.02.01 — Simulation Run Orchestration

**Status:** ✅ Complete  
**Release Date:** 2025-10-20  
**Branch:** `time-travel-m3`

## Overview

M-03.02.01 brings simulation-mode orchestration to `/v1/runs`, allowing FlowTime to generate canonical run bundles directly from FlowTime.Sim templates without telemetry captures. The release keeps telemetry behaviour intact while adding mode-aware validation, observability, and CLI parity.

### Highlights
- **Shared orchestration:** `RunOrchestrationService` now evaluates FlowTime.Sim templates, writes canonical artifacts, emits telemetry manifests, and captures metrics/logs for simulation runs.
- **API support:** `POST /v1/runs` accepts `mode=simulation`, returns `/state`-aligned metadata, and surfaces validation errors with appropriate status codes.
- **CLI reuse:** `flowtime run --template-id <id> --mode simulation` routes through the shared orchestration pipeline; deterministic IDs and reuse of existing flags supported.
- **Schema enforcement:** `manifest.schema.json` requires camelCase provenance fields; `ManifestSchemaValidator` guards runtime artifacts and associated tests ensure compliance.
- **Observability:** Metrics (`run_created_total`, `simulation_evaluation_duration_ms`) and structured logs (`RunOrchestration*`) are asserted through automated tests.

## Testing

| Suite | Command |
|-------|---------|
| Build | `dotnet build FlowTime.sln` |
| API Tests | `dotnet test tests/FlowTime.Api.Tests/FlowTime.Api.Tests.csproj --no-build` |
| CLI Tests | `dotnet test tests/FlowTime.Cli.Tests/FlowTime.Cli.Tests.csproj --no-build` |
| Generator Tests | `dotnet test tests/FlowTime.Generator.Tests/FlowTime.Generator.Tests.csproj --no-build` |
| Adapter Tests | `dotnet test tests/FlowTime.Adapters.Synthetic.Tests/FlowTime.Adapters.Synthetic.Tests.csproj --no-build` |

Golden snapshots were captured for simulation create/get responses. CLI and integration tests verify canonical artifacts, and unit tests confirm schema and observability instrumentation.

## Follow-up

1. Merge `time-travel-m3` to mainline and notify the UI team (UI-M-03.12) that simulation orchestration is ready for consumption.
2. Draft dashboard validation tasks for the newly exposed metrics once the backend reaches shared environments.
3. Continue monitoring schema enforcement and update operator documentation as UI integration progresses.


# Milestone M0 — Model‑driven runner

Status: complete (on branch `milestone/m0`).

## Scope

- Minimal CLI that:
  - Reads a FlowTime YAML model.
  - Posts it to FlowTime API `/run` (Content-Type: text/plain).
  - Writes outputs as CSV or JSON.
- Deterministic output (culture‑invariant), small example model.
- Basic tests for CSV writer, arg parsing, and API error surfacing.

Deferred: async runs (submit/poll), telemetry ingestion (NDJSON/Parquet), richer nodes.

## How to run

Ensure FlowTime.API is running (from sibling repo flowtime-vnext):

```bash
# in ../flowtime-vnext
# run API on 0.0.0.0:8080 inside the devcontainer
dotnet run --project apis/FlowTime.API --urls http://0.0.0.0:8080
```

Test the FlowTime.API is responding

```bash
curl -sS -X POST http://flowtime-api:8080/run -H 'Content-Type: text/plain' --data-binary @examples/m0.const.yaml | jq . 
```

Output:
```json
{                                                                                           
  "grid": {
    "bins": 8,
    "binMinutes": 60
  },
  "order": [
    "demand",
    "served"
  ],
  "series": {
    "demand": [
      10,
      10,
      10,
      10,
      10,
      10,
      10,
      10
    ],
    "served": [
      8,
      8,
      8,
      8,
      8,
      8,
      8,
      8
    ]
  }
}
```

From this repo, run the SIM CLI:

```bash
# in flowtime-sim-vnext
dotnet run --project src/FlowTime.Sim.Cli -- \
  --model examples/m0.const.yaml \
  --flowtime http://flowtime-api:8080 \
  --out out/m0.csv \
  --format csv
```

Outputs:
- CSV header: `bin,index,<node1>,<node2>,...` ordered by `response.order`.
- Values are aligned to `response.grid.bins`.

## Notes

- Default FlowTime URL (when omitted) is `http://localhost:8080`.
- Errors from FlowTime API bubble up with the server message.
- See `.vscode/tasks.json` for build/test/run tasks.

## Next

- Async run pattern (submit/poll/result endpoint trio) in SIM-M1.
- Scenario templates and a YAML model generator.
- True ingestion (NDJSON/"Gold") in later milestone.

# Milestone M2.8 â€” UI Incremental Charter Alignment

**Status:** ðŸ“‹ Planned (Charter-Aligned)  
**Dependencies:** M2.7 (Artifacts Registry)  
**Target:** Incremental UI migration toward charter structure while maintaining functionality  
**Date:** 2025-09-20

---

## Goal

Incrementally migrate the current UI toward the **charter's 4-tab structure** (`[Models] [Runs] [Artifacts] [Learn]`) while maintaining all existing functionality. This milestone introduces the new navigation and core workflows **alongside** the current TemplateRunner, ensuring nothing breaks during transition.

## Context & Charter Alignment

The **FlowTime-Engine Charter** defines a specific UI workflow:
```
[Models]   [Runs]   [Artifacts]   [Learn]
â””â”€ Model authoring + templates
â””â”€ Input selection â†’ Configure â†’ Compute â†’ Results  
â””â”€ Registry with search/browse/actions
â””â”€ Unchanged learning content
```

**Current UI Structure:**
```
Templates â†’ Parameters â†’ Model Preview â†’ Simulate â†’ Analyze  (TemplateRunner)
Learn Pages (separate, working)
```

**Incremental Strategy:** Add charter structure **alongside** existing UI, then gradually migrate users.

## Functional Requirements

### **FR-M2.8-1: Charter Navigation Structure**
Add new navigation structure while preserving current TemplateRunner access.

**New Navigation Layout:**
```csharp
// New main navigation (parallel to existing)
<MudTabs>
    <MudTabPanel Text="Models" Icon="@Icons.Material.Filled.Build">
        @* New: Model authoring interface *@
    </MudTabPanel>
    <MudTabPanel Text="Runs" Icon="@Icons.Material.Filled.PlayArrow">
        @* New: Runs wizard implementation *@
    </MudTabPanel>
    <MudTabPanel Text="Artifacts" Icon="@Icons.Material.Filled.Storage">
        @* New: Artifacts registry browser *@
    </MudTabPanel>
    <MudTabPanel Text="Learn" Icon="@Icons.Material.Filled.School">
        @* Existing: Learn pages (unchanged) *@
    </MudTabPanel>
</MudTabs>

@* Existing TemplateRunner still available during transition *@
<MudDrawerHeader>
    <MudNavLink Href="/templates" Icon="@Icons.Material.Filled.Science">
        Template Studio (Legacy)
    </MudNavLink>
</MudDrawerHeader>
```

**Backward Compatibility:**
- Current `/templates` route continues working
- All existing API calls remain functional  
- No removal of working features during transition
- Users can choose new or legacy interface

### **FR-M2.8-2: Artifacts Tab Implementation**
Implement charter-aligned artifacts registry browser using M2.7 foundation.

**Artifacts Browser Interface:**
```csharp
// /Pages/Artifacts.razor
@page "/artifacts"
@using FlowTime.UI.Services.Artifacts

<MudContainer MaxWidth="MaxWidth.False">
    <MudStack Spacing="3">
        @* Search and Filter Bar *@
        <MudPaper Class="pa-4" Elevation="1">
            <MudGrid AlignItems="AlignItems.Center" Spacing="2">
                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="searchQuery" 
                                Label="Search artifacts" 
                                Variant="Variant.Outlined"
                                Adornment="Adornment.End"
                                AdornmentIcon="@Icons.Material.Filled.Search" />
                </MudItem>
                <MudItem xs="12" md="3">
                    <MudSelect @bind-Value="selectedType" Label="Type" Variant="Variant.Outlined">
                        <MudSelectItem Value="string.Empty">All Types</MudSelectItem>
                        <MudSelectItem Value="model">Models</MudSelectItem>
                        <MudSelectItem Value="run">Runs</MudSelectItem>
                        <MudSelectItem Value="telemetry">Telemetry</MudSelectItem>
                    </MudSelect>
                </MudItem>
                <MudItem xs="12" md="3">
                    <MudButton Variant="Variant.Filled" 
                             Color="Color.Primary" 
                             OnClick="RefreshArtifacts">
                        Refresh
                    </MudButton>
                </MudItem>
            </MudGrid>
        </MudPaper>

        @* Artifacts Cards Grid *@
        <MudGrid Spacing="3">
            @foreach (var artifact in filteredArtifacts)
            {
                <MudItem xs="12" md="6" lg="4">
                    <MudCard Elevation="2">
                        <MudCardHeader>
                            <CardHeaderIcon>
                                <MudIcon Icon="@GetArtifactIcon(artifact.Type)" 
                                       Color="@GetArtifactColor(artifact.Type)" />
                            </CardHeaderIcon>
                            <CardHeaderContent>
                                <MudText Typo="Typo.h6">@artifact.Title</MudText>
                                <MudText Typo="Typo.body2" Color="Color.Secondary">
                                    @artifact.Type.ToUpperInvariant() â€¢ @artifact.Created.ToString("yyyy-MM-dd")
                                </MudText>
                            </CardHeaderContent>
                        </MudCardHeader>
                        <MudCardContent>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                @(string.IsNullOrEmpty(artifact.Description) ? "No description" : artifact.Description)
                            </MudText>
                            @if (artifact.Tags?.Any() == true)
                            {
                                <MudStack Row Spacing="1" Class="mb-2">
                                    @foreach (var tag in artifact.Tags.Take(3))
                                    {
                                        <MudChip Size="Size.Small" Color="Color.Secondary">@tag</MudChip>
                                    }
                                </MudStack>
                            }
                        </MudCardContent>
                        <MudCardActions>
                            @* Charter-aligned actions per artifact type *@
                            @if (artifact.Type == "model")
                            {
                                <MudButton Size="Size.Small" Color="Color.Primary" OnClick="() => RunModelArtifact(artifact.Id)">
                                    Run
                                </MudButton>
                                <MudButton Size="Size.Small" Color="Color.Secondary" OnClick="() => EditModelArtifact(artifact.Id)">
                                    Edit
                                </MudButton>
                            }
                            else if (artifact.Type == "run")
                            {
                                <MudButton Size="Size.Small" Color="Color.Primary" OnClick="() => OpenRunResults(artifact.Id)">
                                    Results
                                </MudButton>
                                <MudButton Size="Size.Small" Color="Color.Secondary" OnClick="() => CompareRunArtifact(artifact.Id)">
                                    Compare
                                </MudButton>
                                <MudButton Size="Size.Small" Color="Color.Tertiary" OnClick="() => ExportRunArtifact(artifact.Id)">
                                    Export
                                </MudButton>
                            }
                            else if (artifact.Type == "telemetry")
                            {
                                <MudButton Size="Size.Small" Color="Color.Primary" OnClick="() => ReplayTelemetryArtifact(artifact.Id)">
                                    Replay
                                </MudButton>
                                <MudButton Size="Size.Small" Color="Color.Secondary" OnClick="() => CompareTelemetryArtifact(artifact.Id)">
                                    Compare
                                </MudButton>
                            }
                        </MudCardActions>
                    </MudCard>
                </MudItem>
            }
        </MudGrid>
    </MudStack>
</MudContainer>
```

**Artifacts Service Integration:**
```csharp
// Services/ArtifactBrowserService.cs
public interface IArtifactBrowserService
{
    Task<List<ArtifactSummary>> GetArtifactsAsync(ArtifactFilter filter);
    Task<ArtifactDetail?> GetArtifactAsync(string id);
    Task RunModelArtifactAsync(string artifactId);
    Task OpenRunResultsAsync(string artifactId);
    Task StartCompareWorkflowAsync(string baselineArtifactId);
}

public class ArtifactBrowserService : IArtifactBrowserService
{
    private readonly IHttpClientFactory httpClientFactory;
    
    public async Task<List<ArtifactSummary>> GetArtifactsAsync(ArtifactFilter filter)
    {
        using var client = httpClientFactory.CreateClient("FlowTimeAPI");
        var query = BuildQueryString(filter);
        var response = await client.GetAsync($"/v1/artifacts{query}");
        // ... M2.7 artifacts API integration
    }
}
```

### **FR-M2.8-3: Runs Tab Foundation**
Implement basic Runs wizard structure to support charter workflow.

**Runs Wizard Interface:**
```csharp
// /Pages/Runs.razor  
@page "/runs"

<MudContainer MaxWidth="MaxWidth.False">
    <MudText Typo="Typo.h4" GutterBottom="true">Run Analysis</MudText>
    <MudText Typo="Typo.body1" Class="mb-4">
        Execute models and analyze results using the FlowTime Engine.
    </MudText>
    
    <MudTabs @bind-ActivePanelIndex="activeStep" Elevation="2" ApplyEffectsToContainer="true">
        <MudTabPanel Text="1. Select Input" Icon="@Icons.Material.Filled.Input" Disabled="false">
            <RunsWizardInputSelection @bind-SelectedInput="selectedInput" 
                                    ArtifactService="ArtifactBrowserService" />
        </MudTabPanel>
        
        <MudTabPanel Text="2. Configure" Icon="@Icons.Material.Filled.Settings" 
                   Disabled="@(selectedInput == null)">
            <RunsWizardConfiguration @bind-Configuration="runConfiguration" 
                                   Input="selectedInput" />
        </MudTabPanel>
        
        <MudTabPanel Text="3. Compute" Icon="@Icons.Material.Filled.PlayCircle" 
                   Disabled="@(runConfiguration == null)">
            <RunsWizardExecution Configuration="runConfiguration" 
                               OnRunCompleted="HandleRunCompleted" />
        </MudTabPanel>
        
        <MudTabPanel Text="4. Results" Icon="@Icons.Material.Filled.Analytics" 
                   Disabled="@(currentRunResult == null)">
            <RunsWizardResults RunResult="currentRunResult" 
                             OnCompareClicked="StartCompareWorkflow" />
        </MudTabPanel>
    </MudTabs>
</MudContainer>
```

**Input Selection Component (Charter Implementation):**
```csharp
// /Components/Runs/RunsWizardInputSelection.razor
@using FlowTime.UI.Services.Artifacts

<MudGrid Spacing="3">
    <MudItem xs="12">
        <MudText Typo="Typo.h6">Choose Input Source:</MudText>
    </MudItem>
    
    <MudItem xs="12" md="4">
        <MudPaper Class="pa-4" Elevation="1" Style="min-height: 200px;">
            <MudRadio @bind-SelectedOption="inputType" T="string" Option="model" Color="Color.Primary" />
            <MudText Typo="Typo.h6" Class="mb-2">Model Artifact</MudText>
            <MudText Typo="Typo.body2" Class="mb-3">
                Run a model created in FlowTime-Sim or uploaded to the registry.
            </MudText>
            @if (inputType == "model")
            {
                <MudButton Variant="Variant.Outlined" 
                         FullWidth="true" 
                         OnClick="BrowseModelArtifacts">
                    Browse Models...
                </MudButton>
            }
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" md="4">
        <MudPaper Class="pa-4" Elevation="1" Style="min-height: 200px;">
            <MudRadio @bind-SelectedOption="inputType" T="string" Option="telemetry" Color="Color.Secondary" />
            <MudText Typo="Typo.h6" Class="mb-2">Telemetry Artifact</MudText>
            <MudText Typo="Typo.body2" Class="mb-3">
                Replay analysis from previously imported telemetry data.
            </MudText>
            @if (inputType == "telemetry")
            {
                <MudButton Variant="Variant.Outlined" 
                         FullWidth="true" 
                         Color="Color.Secondary"
                         OnClick="BrowseTelemetryArtifacts">
                    Browse Telemetry...
                </MudButton>
            }
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" md="4">
        <MudPaper Class="pa-4" Elevation="1" Style="min-height: 200px;">
            <MudRadio @bind-SelectedOption="inputType" T="string" Option="upload" Color="Color.Tertiary" />
            <MudText Typo="Typo.h6" Class="mb-2">Upload CSV</MudText>
            <MudText Typo="Typo.body2" Class="mb-3">
                Upload external telemetry in Gold CSV format for analysis.
            </MudText>
            @if (inputType == "upload")
            {
                <MudFileUpload T="IBrowserFile" Accept=".csv" 
                             MaximumFileCount="1"
                             OnFilesChanged="HandleFileUpload">
                    <ButtonTemplate>
                        <MudButton HtmlTag="label"
                                 Variant="Variant.Outlined" 
                                 Color="Color.Tertiary"
                                 FullWidth="true"
                                 for="@context">
                            Upload CSV...
                        </MudButton>
                    </ButtonTemplate>
                </MudFileUpload>
            }
        </MudPaper>
    </MudItem>
</MudGrid>

@if (selectedInput != null)
{
    <MudAlert Severity="Severity.Success" Class="mt-3">
        <strong>Selected:</strong> @selectedInput.Title (@selectedInput.Type)
        <MudButton Size="Size.Small" 
                 Color="Color.Primary" 
                 Variant="Variant.Text" 
                 Class="ml-2"
                 OnClick="ClearSelection">
            Change
        </MudButton>
    </MudAlert>
}
```

### **FR-M2.8-4: Models Tab Placeholder**
Implement basic Models tab structure for future FlowTime-Sim integration.

**Models Tab Foundation:**
```csharp
// /Pages/Models.razor
@page "/models"

<MudContainer MaxWidth="MaxWidth.False">
    <MudText Typo="Typo.h4" GutterBottom="true">Model Authoring</MudText>
    <MudText Typo="Typo.body1" Class="mb-4">
        Create and edit models using FlowTime-Sim templates.
    </MudText>
    
    @* Placeholder during M2.8 - link to existing TemplateRunner *@
    <MudAlert Severity="Severity.Info" Class="mb-4">
        <strong>Transition Notice:</strong> Model authoring is currently available in 
        <MudLink Href="/templates">Template Studio</MudLink>. 
        This tab will be fully implemented in future milestones.
    </MudAlert>
    
    <MudPaper Class="pa-4" Elevation="1">
        <MudStack Spacing="3">
            <MudText Typo="Typo.h6">Quick Actions</MudText>
            
            <MudGrid Spacing="2">
                <MudItem xs="12" md="6">
                    <MudButton Variant="Variant.Filled" 
                             Color="Color.Primary"
                             StartIcon="@Icons.Material.Filled.Add"
                             Href="/templates"
                             FullWidth="true">
                        Create New Model (Template Studio)
                    </MudButton>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudButton Variant="Variant.Outlined" 
                             Color="Color.Secondary"
                             StartIcon="@Icons.Material.Filled.FileUpload"
                             OnClick="ShowUploadModelDialog"
                             FullWidth="true">
                        Upload YAML Model
                    </MudButton>
                </MudItem>
            </MudGrid>
            
            <MudDivider />
            
            <MudText Typo="Typo.h6">Recent Models</MudText>
            @* Show recent Model artifacts from registry *@
            <ArtifactsList Type="model" Limit="5" ShowActions="true" />
        </MudStack>
    </MudPaper>
</MudContainer>
```

## Technical Architecture

### **Incremental Navigation Strategy**
```csharp
// Layout/ExpertLayout.razor - Modified navigation
<MudNavMenu>
    @* New Charter Structure *@
    <MudNavGroup Text="Charter UI (New)" Icon="@Icons.Material.Filled.NewReleases" Expanded="false">
        <MudNavLink Href="/models" Icon="@Icons.Material.Filled.Build">Models</MudNavLink>
        <MudNavLink Href="/runs" Icon="@Icons.Material.Filled.PlayArrow">Runs</MudNavLink>
        <MudNavLink Href="/artifacts" Icon="@Icons.Material.Filled.Storage">Artifacts</MudNavLink>
    </MudNavGroup>
    
    @* Existing UI (Preserved) *@
    <MudNavGroup Text="Current UI" Icon="@Icons.Material.Filled.Science" Expanded="true">
        <MudNavLink Href="/templates" Icon="@Icons.Material.Filled.Science">Template Studio</MudNavLink>
        <MudNavLink Href="/analyze" Icon="@Icons.Material.Filled.Analytics">Analyze</MudNavLink>
    </MudNavGroup>
    
    @* Unchanged Learn Section *@
    <MudNavGroup Text="Learn" Icon="@Icons.Material.Filled.School" Expanded="false">
        <MudNavLink Href="/learn" Icon="@Icons.Material.Filled.School">Getting Started</MudNavLink>
        <MudNavLink Href="/learn/concepts" Icon="@Icons.Material.Filled.Lightbulb">Concepts</MudNavLink>
        @* ... existing learn pages unchanged ... *@
    </MudNavGroup>
</MudNavMenu>
```

### **Service Layer Extensions**
```csharp
// Add artifacts-focused services alongside existing ones
builder.Services.AddScoped<IArtifactBrowserService, ArtifactBrowserService>();
builder.Services.AddScoped<IRunsWizardService, RunsWizardService>();
builder.Services.AddScoped<ICompareWorkflowService, CompareWorkflowService>();

// Keep existing services unchanged during transition
builder.Services.AddScoped<ITemplateService>(sp => /* existing implementation */);
builder.Services.AddScoped<ICatalogService>(sp => /* existing implementation */);
// ... all current services remain
```

### **Routing Strategy**
```csharp
// Program.cs - Add new routes alongside existing
var builder = WebAssemblyHostBuilder.CreateDefault(args);

// New charter routes
builder.RootComponents.Add<Models>("#app");      // /models
builder.RootComponents.Add<Runs>("#app");        // /runs  
builder.RootComponents.Add<Artifacts>("#app");   // /artifacts

// Existing routes (unchanged)
builder.RootComponents.Add<TemplateRunner>("#app"); // /templates
builder.RootComponents.Add<Analyze>("#app");        // /analyze
builder.RootComponents.Add<Learn.Index>("#app");    // /learn/*
```

## Integration Points

### **M2.7 Artifacts Registry**
- Artifacts tab consumes M2.7 REST API for artifact listing and actions
- Registry service provides data for Runs wizard input selection  
- Artifact browser enables charter "Browse Registry..." workflows

### **Existing TemplateRunner**
- Legacy Template Studio remains fully functional during transition
- Users can choose between charter Runs wizard or existing TemplateRunner
- No breaking changes to current workflows or API integrations

### **M2.6 Export System**
- Export functionality available in both charter Results view and legacy TemplateRunner
- Run artifacts (M2.7) integrate with M2.6 export files for discoverability

## Acceptance Criteria

### **Navigation & Structure**
- âœ… New 4-tab charter structure accessible alongside existing UI
- âœ… All existing functionality (TemplateRunner, Learn pages, Analyze) works unchanged  
- âœ… Users can seamlessly switch between charter UI and legacy UI
- âœ… No broken links or missing functionality during transition period

### **Artifacts Integration**
- âœ… Artifacts tab displays all artifact types with correct metadata
- âœ… Charter-aligned actions work for each artifact type (Run, Edit, Compare, etc.)
- âœ… Search and filtering provide responsive performance
- âœ… Artifacts browser integrates with M2.7 registry API endpoints

### **Runs Wizard Foundation**
- âœ… 4-step wizard structure (Input â†’ Configure â†’ Compute â†’ Results) functional
- âœ… Input selection supports browsing Model and Telemetry artifacts from registry
- âœ… CSV upload creates Telemetry artifacts via M2.7 system
- âœ… Wizard state management preserves progress through steps

### **Backward Compatibility**
- âœ… All existing routes and functionality preserved and working
- âœ… No regressions in performance or user experience  
- âœ… Current API integrations remain stable
- âœ… Learn section completely unchanged

## Implementation Plan

### **Phase 1: Navigation & Structure (Week 1)**
1. **Add charter navigation** alongside existing drawer menu
2. **Create placeholder pages** for Models, Runs, Artifacts tabs
3. **Preserve all existing routes** and ensure no regressions
4. **Update layout** to show both charter and legacy UI options

### **Phase 2: Artifacts Tab (Week 2)**  
1. **Implement artifacts browser** with M2.7 API integration
2. **Add search and filtering** with responsive performance
3. **Charter-aligned actions** for each artifact type
4. **Integration testing** with M2.7 registry endpoints

### **Phase 3: Runs Wizard Foundation (Week 3)**
1. **4-step wizard structure** with proper state management  
2. **Input selection component** with registry browsing
3. **Basic configuration and execution** reusing existing engine integration
4. **Results view** that can launch Compare workflow

### **Phase 4: Polish & Integration (Week 4)**
1. **Visual design consistency** between charter and legacy UI
2. **Performance optimization** for large artifact collections
3. **User experience testing** for navigation and workflows
4. **Documentation** for charter UI usage and migration path

## Risk Mitigation

### **User Experience Risk**
**Risk:** Two parallel UI structures confuse users during transition  
**Mitigation:**
- Clear labeling of "Charter UI (New)" vs "Current UI"  
- Transition guide documentation
- Gradual migration path with user choice

### **Complexity Risk**
**Risk:** Maintaining two UI paradigms increases development complexity  
**Mitigation:**
- Shared service layer reduces duplication
- Time-boxed transition period (target: 2-3 milestones)
- Focus on charter UI as primary development path

### **Integration Risk**  
**Risk:** Charter UI and M2.7 registry integration has gaps or performance issues  
**Mitigation:**
- Incremental rollout with fallbacks to legacy UI
- Comprehensive testing with mock and real data
- Performance benchmarks established early

## Success Metrics

### **Adoption Metrics**
- **Charter UI usage**: Track page visits to new tabs vs legacy TemplateRunner
- **Workflow completion**: Users successfully complete Runs wizard end-to-end
- **Zero regressions**: All existing functionality maintains current performance

### **Technical Metrics**  
- **Performance**: Artifacts browser loads in < 2 seconds for 100+ artifacts
- **Integration**: 100% of M2.7 API endpoints consumed correctly
- **Reliability**: Zero navigation errors or broken states

### **Charter Readiness Metrics**
- **Input selection**: Runs wizard can browse and select all artifact types
- **Compare foundation**: Registry actions enable future Compare workflow
- **Artifact lifecycle**: Users can discover, use, and manage artifacts end-to-end

---

## Next Steps

1. **M2.9-COMPARE**: Implement charter Compare workflow using artifacts registry
2. **SIM-M3.0-CHARTER**: FlowTime-Sim alignment to generate Model artifacts  
3. **M3.0-CHARTER-COMPLETE**: Remove legacy UI and complete charter implementation

This milestone provides the **incremental foundation** for charter alignment while maintaining stability and user confidence during the transition.

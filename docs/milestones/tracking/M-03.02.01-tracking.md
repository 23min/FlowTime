# M-03.02.01 Implementation Tracking

**Milestone:** M-03.02.01 — Simulation Run Orchestration  
**Status:** ✅ Complete  
**Branch:** `time-travel-m3`  
**Assignee:** [TBD]

---

## Quick Links

- Milestone Document: docs/milestones/M-03.02.01.md
- Release Notes: docs/releases/M-03.02.01.md
- Roadmap: docs/architecture/time-travel/time-travel-planning-roadmap.md
- Planning Decisions: docs/architecture/time-travel/time-travel-planning-decisions.md
- Simulation Architecture: docs/architecture/time-travel/sim/sim-architecture-overview.md
- Development Approach: TDD (Red → Green → Refactor) for every change

---

## Current Status

### Overall Progress
- [x] Phase 1: Service Layer Refactor (3/3 tasks)
- [x] Phase 2: API & CLI Integration (3/3 tasks)
- [x] Phase 3: Tests, Observability, Documentation (4/4 tasks)

### Test Status
- Unit Tests: 4 / planned (RunOrchestrationService simulation coverage, manifest schema validation, CLI orchestration reuse)
- Integration Tests: 2 / planned (API `/v1/runs` simulation path + validation failure)
- Golden Tests: 2 / planned (simulation create/get snapshots)
- Observability Checks: Metrics/log events asserted in unit tests
- CI Build: `dotnet build FlowTime.sln`

---

## Progress Log

### 2025-10-18 — Planning

- [x] Drafted milestone spec `M-03.02.01.md` outlining simulation-mode orchestration scope.
- [x] Created tracking document; no implementation work started.
- [ ] Backend branch kickoff (pending).
- [ ] Re-affirm TDD workflow before each task (tests first, then implementation, then refactor).

### 2025-10-19 — Service & API Integration

- [x] Refactored `RunOrchestrationService` for simulation mode (FlowTime.Sim evaluation, canonical artifact emission, telemetry manifest writer, structured logs/metrics).
- [x] Updated `/v1/runs` to accept simulation payloads, surface validation errors, and return `/state`-aligned metadata + `canReplay` (simulation).
- [x] Routed CLI `flowtime run --template-id <id> --mode simulation` through orchestration service; added CLI simulation test coverage.
- [x] Added generator/API/golden tests for simulation runs; updated `FlowTime.API.http` with simulation samples and refreshed milestone documentation.

### 2025-10-20 — Observability & Documentation

- [x] Added `ManifestSchemaValidator` guard to enforce camelCase provenance and validated manifests in adapters/tests.
- [x] Captured `run_created_total` and `simulation_evaluation_duration_ms` metrics plus completion logs via new unit tests.
- [x] Updated milestone/tracking docs and published release notes (`docs/releases/M-03.02.01.md`).

---

## Phase Breakdown

### Phase 1: Service Layer Refactor

Goal: Extend `RunOrchestrationService` to support simulation mode without telemetry dependencies.

Checklist:
- [x] Mode branching implemented (simulation vs telemetry).
- [x] Synthetic artifact generation (run.json, manifest, index).
- [x] Simulation validation/warning semantics applied.

Status: ✅ Complete

### Phase 2: API & CLI Integration

Goal: Wire simulation orchestration into REST API and CLI.

Checklist:
- [x] `POST /v1/runs` simulation path returns metadata envelope.
- [x] Response includes artifact presence flags and `canReplay`.
- [x] CLI (`flowtime run --mode simulation`) reuses orchestration service.

Status: ✅ Complete

### Phase 3: Tests, Observability, Documentation

Goal: Ensure coverage, instrumentation, and docs for simulation runs.

Checklist:
- [x] Unit & integration tests implemented and passing.
- [x] Golden snapshots captured for API responses.
- [x] Structured logs/metrics verified in simulation mode (log hooks + metric counters).
- [x] Documentation updates (`.http` samples, operator guide, release notes).

Status: ✅ Complete

---

## Risks & Mitigations

- **Shared artifacts for telemetry vs simulation** — ensure file writers handle both paths consistently. Mitigation: unit tests on artifact generation.
- **Validation severity divergence** — simulation must fail fast; telemetry warns. Mitigation: tests covering both modes.
- **CLI/API drift** — reuse orchestration service; integration tests for CLI parity.

---

## Next Steps

1. Coordinate with UI team once branch merges to unblock UI-M-03.12 and resume simulate UI work.
2. Plan metrics dashboard validation after instrumentation lands in shared environment.
3. Monitor schema validation telemetry for regressions after merge.

| Milestone                                           | Engine (FlowTime)                                                                                                                                             | Sim (FlowTime-Sim)                                                                                            | UI (FlowTime.UI)                                          | Acceptance (shared)                                                              |
| --------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------- | -------------------------------------------------------------------------------- |
| **M0 — Core Foundations**                           | Grid, `Series<T>`, DAG eval; const + binary ops; CLI `run`; API: `/run`, `/graph`, `/healthz`.                                                                | —                                                                                                             | Minimal chart reading API/CSV.                            | Deterministic eval, cycle detection; chart shows demand/served.                  |
| **M1 — Contracts Parity Pack**                      | Dual-write artifacts: `run.json`, `manifest.json`, `series/index.json`, per-series CSV; JSON-Schema validation; deterministic hashing.                        | SIM-M2: produce **same** artifact shapes (schemaVersion 1).                                                   | Renders exclusively from artifacts (no bespoke payloads). | CI schema validation; CLI vs API parity; Sim pack consumable by Engine adapters. |
| **M1.5 — Focused Expressions** ✅ **COMPLETED**      | Expr parser (`+ - * / MIN MAX CLAMP`) + `SHIFT(series,k)`; ref resolution.                                                                                    | — (Sim is not an expr evaluator).                                                                             | Example models; verify SHIFT lag visually.                | SHIFT unit tests; no algebraic loops.                                            |
| **M2 — PMF (EV only)** *(optional early)*           | `pmf` node → expected value series; normalization.                                                                                                            | (Opt) generator matching EV for demo parity.                                                                  | Metadata note: “PMF normalized.”                          | PMF probs sum≈1; expected values match CSV.                                      |
| **M3 — Backlog v1 + Latency + Artifact Endpoints**  | `backlog[t]=max(0, b[t-1]+inflow[t]-served[t])`; `latency[t]=served? b[t]/served*binMinutes : 0`; expose `/runs/{id}/index` & `/runs/{id}/series/{seriesId}`. | SIM-M3: basic generators for `arrivals, served, capacity`; derive `backlog` identically; deterministic seeds. | Run metadata viewer, series picker, conservation badge.   | Conservation holds; div-by-zero safe; artifact endpoints stream correctly.       |
| **M4 — Scenarios & Compare**                        | Overlay YAML (time-windowed demand/capacity); `compare` CLI; emit `delta.csv`, `kpi.csv`.                                                                     | SIM-M4: baseline + overlays with same semantics.                                                              | Overlay editor; side-by-side charts; KPI deltas.          | Overlay invariants; Engine↔Sim compare reproducible.                             |
| **M5 — Routing / Fan-out / Capacity Caps**          | `RouterNode`, `FanOutNode`, `CapacityNode` (+ overflow).                                                                                                      | SIM-M5: multi-path synthetic data (`arrivals/served/overflow`) to exercise routing.                           | Graph visualizer; hover sparklines.                       | Splits sum to 1; overflow computed; path conservation verified.                  |
| **M6 — Batch Windows**                              | `BatchGateNode` (open/close; release on open).                                                                                                                | SIM-M6.pre: periodic closures & releases.                                                                     | Shaded batch window overlays.                             | Visible batch spikes; gate schedule aligns to bins.                              |
| **M6.5 — Cross-System Compatibility Pack**          | Shared golden vectors, RNG (PCG32) determinism, grid alignment tests.                                                                                         | Same; produce/consume each other’s packs in CI.                                                               | Badge in run metadata when cross-validation passes.       | Both sides pass integration suite without code changes.                          |
| **M7 — Backlog v2 (Buffers & Spill)**               | Finite buffers; spill to DLQ (no retries yet); configurable draining.                                                                                         | SIM-M7: emit controlled DLQ/spill patterns.                                                                   | DLQ/spill indicators & area overlays.                     | Conservation with spill; buffer limits enforced.                                 |
| **M8 — Multi-Class + Priority/Fairness**            | Class-aware series IDs; weighted-fair & strict priority sharing.                                                                                              | SIM-M8: per-class generators; mirrored policies.                                                              | Class segmentation controls & legend.                     | Per-class + aggregate conservation; policy conformance under binding capacity.   |
| **M9 — Data Import & Fitting**                      | CSV adapter for Gold schema; resampling; capacity smoothing; basic fitting helpers.                                                                           | SIM-M9: telemetry-like corpora for eval.                                                                      | Telemetry overlay & fit metrics.                          | Bins align post-resample; fitting improves objective on test set.                |
| **M9.5 — Retry & Feedback Modeling** **(deferred)** | `CONV`, `DELAY`, `RETRY`, `EMA`; conservation validator; single-pass (no algebraic loops).                                                                    | **SIM-M6**: retry kernel/echo generators; conservation datasets.                                              | Retry echo viz; conservation diagnostics.                 | Retry volumes match kernels; conservation holds with retries & DLQ.              |
| **M10 — Scenario Sweeps**                           | Param sweep runner; `sweep.csv`, `sweep.html`.                                                                                                                | Sweepable parameters exposed.                                                                                 | Sweep explorer with facets/brush.                         | Reproducible grid; stable KPIs across runs.                                      |
| **M11 — Headless Runner + API Hardening**           | Endpoints for run/compare/sweep; `/state_window` partial extracts.                                                                                            | —                                                                                                             | UI switches to API e2e (no stubs).                        | e2e smoke suite green; windowed extracts bounded and correct.                    |
| **M12 — Template v2**                               | Template expansion; typed params & validation.                                                                                                                | Provide template packs for demos.                                                                             | Template explorer & generated forms.                      | Idempotent expansion; clear validation errors in UI.                             |
| **M13 — Backlog v3 (Priority Spill & Class Depth)** | Richer spill semantics (priority spill, per-class buffers).                                                                                                   | Datasets with controlled priority spill.                                                                      | DLQ vs main queue visuals; class filters.                 | Class-aware spill invariants pass.                                               |
| **M14 — Calibration & Drift**                       | Learn routing & retry kernels from telemetry; drift reports w/ CIs.                                                                                           | Labeled “truth” datasets for eval.                                                                            | Drift dashboard.                                          | Calibration reduces error; drift alerts on synthetic regressions.                |
| **M15 — Uncertainty Bands**                         | Monte Carlo; percentile bands (P50/P90) in artifacts.                                                                                                         | Seeded stochastic variants.                                                                                   | Shaded percentile bands; toggles.                         | Deterministic with fixed seeds; percentile math correct.                         |
| **M16 — WASM Engine (Future)**                      | WASM binding with parity tests; browser mode toggle.                                                                                                          | —                                                                                                             | Run mode switch (Server/WASM).                            | Byte-level parity on golden vectors.                                             |

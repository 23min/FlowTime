{
  "name": "FlowTime Dev",
  "image": "mcr.microsoft.com/devcontainers/dotnet:1-9.0",
  "workspaceFolder": "/workspaces/flowtime-vnext",
  "workspaceMount": "source=${localWorkspaceFolder}/..,target=/workspaces,type=bind,consistency=cached",
  "features": {
    "ghcr.io/devcontainers/features/powershell:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/node:1": {
      "version": "20"
    }
  },
  "updateContentCommand": "pwsh .devcontainer/init.ps1",
  "postCreateCommand": "pwsh .devcontainer/init.ps1 --PostCreate",
  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "pwsh",
        "github.useLocalServer": false,
        "dotnet.server.useOmnisharp": false,
        "editor.formatOnSave": true,
        "yaml.validate": true,
        "yaml.format.enable": true,
        "yaml.schemas": {
          "https://json.schemastore.org/github-workflow.json": ".github/workflows/*.yml",
          "https://json.schemastore.org/github-action.json": ".github/actions/**/action.yml"
        }
      },
      "extensions": [
        "ms-dotnettools.csdevkit",
        "ms-dotnettools.csharp",
        "EditorConfig.EditorConfig",
        "github.vscode-github-actions",
        "mhutchie.git-graph",
        "redhat.vscode-yaml",
        "GitHub.copilot",
        "github.copilot-chat",
        "openai.chatgpt",
        "humao.rest-client",
        "shd101wyy.markdown-preview-enhanced"
      ],
      "mcp": {
        "servers": {
          "serena": {
            "command": "bash",
            "args": [
              "-c",
              "export PATH=\"$HOME/.local/bin:$PATH\" && uvx --from git+https://github.com/oraios/serena serena start-mcp-server --context ide-assistant --project /workspaces/flowtime-vnext"
            ]
          }
        }
      }
    }
  },
  "remoteUser": "vscode",
  "runArgs": [
    "--cap-add=SYS_PTRACE",
    "--security-opt",
    "seccomp=unconfined",
    "--sysctl",
    "net.ipv6.conf.all.disable_ipv6=1",
    "--sysctl",
    "net.ipv6.conf.default.disable_ipv6=1",
    "--network=flowtime-dev",
    "--name",
    "flowtime-api"
  ],
  "containerEnv": {
    "MSBUILDNOINPROCNODE": "1",
    "FLOWTIME_API_BASEURL": "http://flowtime-api:8080",
    "FLOWTIME_API_VERSION": "v1"
  },
  "forwardPorts": [
    8080,
    8090,
    8091
  ],
  "remoteEnv": {
    "NODE_OPTIONS": "--dns-result-order=ipv4first",
    "PATH": "${containerEnv:HOME}/.local/bin:${containerEnv:PATH}"
  }
}

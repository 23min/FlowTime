# IT System with Microservices - Template
# Modern web application with request queues, load balancer, auth service, and database bottlenecks

metadata:
  title: 'IT System with Microservices'
  description: 'Modern web application with request queues, load balancer, auth service, and database bottlenecks'
  templateId: 'it-system-microservices'
  tags: [intermediate, microservices, web-scale, modern, it-systems]
  parameters:
    - name: bins
      type: integer
      title: "Time Periods"
      description: "Number of time periods to simulate"
      defaultValue: 12
      minimum: 3
      maximum: 48
    - name: binMinutes
      type: integer
      title: "Minutes per Period"
      description: "Duration of each time period"
      defaultValue: 60
      minimum: 15
      maximum: 480
    - name: requestPattern
      type: numberArray
      title: "User Request Pattern"
      description: "Number of requests per time period"
      defaultValue: [100, 150, 200, 180, 120, 80]
      minimum: 0
      maximum: 10000
    - name: loadBalancerCapacity
      type: numberArray
      title: "Load Balancer Capacity"
      description: "Load balancer throughput per time period"
      defaultValue: [300, 300, 300, 300, 300, 300]
      minimum: 1
      maximum: 10000
    - name: authCapacity
      type: numberArray  
      title: "Auth Service Capacity"
      description: "Authentication service throughput per time period"
      defaultValue: [250, 250, 250, 250, 250, 250]
      minimum: 1
      maximum: 10000
    - name: databaseCapacity
      type: numberArray
      title: "Database Capacity"
      description: "Database query capacity per time period"
      defaultValue: [180, 180, 180, 180, 180, 180]
      minimum: 1
      maximum: 10000

schemaVersion: 1
grid:
  bins: {{bins}}
  binMinutes: {{binMinutes}}

nodes:
  # Incoming user requests (varies by time of day)
  - id: user_requests
    kind: const
    values: {{requestPattern}}

  # Load balancer processing capacity
  - id: load_balancer_capacity
    kind: const
    values: {{loadBalancerCapacity}}

  # Authentication service capacity
  - id: auth_capacity
    kind: const
    values: {{authCapacity}}

  # Database capacity
  - id: database_capacity
    kind: const
    values: {{databaseCapacity}}

  # Requests processed by load balancer
  - id: load_balanced_requests
    kind: expr
    expr: "MIN(user_requests, load_balancer_capacity)"

  # Requests processed by auth service
  - id: authenticated_requests
    kind: expr
    expr: "MIN(load_balanced_requests, auth_capacity)"

  # Requests processed by database
  - id: processed_requests
    kind: expr
    expr: "MIN(authenticated_requests, database_capacity)"

  # Failed requests (bottlenecked)
  - id: failed_requests
    kind: expr
    expr: "user_requests - processed_requests"

  # System utilization
  - id: system_utilization
    kind: expr
    expr: "processed_requests / user_requests"

outputs:
  - series: user_requests
    as: requests.csv
  - series: processed_requests
    as: processed.csv
  - series: failed_requests
    as: failures.csv
  - series: system_utilization
    as: utilization.csv
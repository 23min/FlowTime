# IT System with Microservices - Template
# Modern web application with request queues, load balancer, auth service, and database bottlenecks

metadata:
  title: 'IT System with Microservices'
  description: 'Modern web application with request queues, load balancer, auth service, and database bottlenecks'
  templateId: 'it-system-microservices'
  tags: [intermediate, microservices, web-scale, modern, it-systems]

schemaVersion: 1
grid:
  bins: {{bins}}
  binMinutes: {{binMinutes}}

nodes:
  # Incoming user requests (varies by time of day)
  - id: user_requests
    kind: const
    values: {{requestPattern}}

  # Load balancer processing capacity
  - id: load_balancer_capacity
    kind: const
    values: {{loadBalancerCapacity}}

  # Authentication service capacity
  - id: auth_capacity
    kind: const
    values: {{authCapacity}}

  # Database capacity
  - id: database_capacity
    kind: const
    values: {{databaseCapacity}}

  # Requests processed by load balancer
  - id: load_balanced_requests
    kind: expr
    expr: "MIN(user_requests, load_balancer_capacity)"

  # Requests processed by auth service
  - id: authenticated_requests
    kind: expr
    expr: "MIN(load_balanced_requests, auth_capacity)"

  # Requests processed by database
  - id: processed_requests
    kind: expr
    expr: "MIN(authenticated_requests, database_capacity)"

  # Failed requests (bottlenecked)
  - id: failed_requests
    kind: expr
    expr: "user_requests - processed_requests"

  # System utilization
  - id: system_utilization
    kind: expr
    expr: "processed_requests / user_requests"

outputs:
  - series: user_requests
    as: requests.csv
  - series: processed_requests
    as: processed.csv
  - series: failed_requests
    as: failures.csv
  - series: system_utilization
    as: utilization.csv
schemaVersion: 1
generator: flowtime-sim
metadata:
  id: 'transportation-basic'
  title: 'Transportation Network'
  description: 'Simple transportation flow with demand and capacity constraints, ideal for logistics learning'
  version: 1.0.0
  captureKey: transportation-basic-telemetry
  tags: [beginner, transportation, logistics, capacity]
window:
  start: 2025-01-01T00:00:00Z
  timezone: UTC

parameters:
  - name: bins
    type: integer
    title: "Time Periods"
    description: "Number of time periods to simulate"
    default: 6
    minimum: 3
    maximum: 48
  - name: binSize
    type: integer
    title: "Period Duration"
    description: "Duration of each time period in minutes"
    default: 60
    minimum: 15
    maximum: 480
  - name: demandPattern
    type: array
    title: "Passenger Demand Pattern"
    description: "Number of passengers wanting to travel in each time period"
    default: [10, 15, 20, 25, 18, 12]
    minimum: 0
    maximum: 1000
  - name: capacityPattern
    type: array
    title: "Vehicle Capacity Pattern"
    description: "Number of available seats/spaces in each time period"
    default: [15, 18, 25, 30, 22, 16]
    minimum: 1
    maximum: 1000
  - name: telemetryDemandSource
    type: string
    title: "Telemetry demand source"
    description: "Optional file:// URI for passenger demand when replaying telemetry"
    default: ""

grid:
  bins: ${bins}
  binSize: ${binSize}
  binUnit: minutes

topology:
  nodes:
    - id: TransitLine
      kind: service
      semantics:
        arrivals: passenger_demand
        served: passengers_served
        errors: unmet_demand
  edges: []

nodes:
  - id: passenger_demand
    kind: const
    values: ${demandPattern}
    source: ${telemetryDemandSource}

  - id: vehicle_capacity
    kind: const
    values: ${capacityPattern}

  - id: passengers_served
    kind: expr
    expr: "MIN(passenger_demand, vehicle_capacity)"

  - id: unmet_demand
    kind: expr
    expr: "MAX(0, passenger_demand - vehicle_capacity)"

  - id: utilization
    kind: expr
    expr: "passengers_served / vehicle_capacity"

outputs:
  - series: passenger_demand
    as: demand.csv
  - series: passengers_served
    as: served.csv
  - series: unmet_demand
    as: overcrowding.csv
  - series: utilization
    as: utilization.csv

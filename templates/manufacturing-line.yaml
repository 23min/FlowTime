schemaVersion: 1
generator: flowtime-sim
metadata:
  id: 'manufacturing-line'
  title: 'Manufacturing Production Line'
  description: 'Production line with workstations, quality control, and bottleneck identification'
  version: 1.0.0
  captureKey: manufacturing-line-telemetry
  tags: [intermediate, manufacturing, production, bottleneck, quality]
window:
  start: 2025-01-01T00:00:00Z
  timezone: UTC

parameters:
  - name: bins
    type: integer
    title: "Time Periods"
    description: "Number of time periods to simulate"
    default: 6
    minimum: 3
    maximum: 48
  - name: binSize
    type: integer
    title: "Period Duration"
    description: "Duration of each time period in minutes"
    default: 60
    minimum: 15
    maximum: 480
  - name: rawMaterialSchedule
    type: array
    title: "Raw Material Schedule"
    description: "Amount of raw materials available in each time period"
    default: [100, 100, 80, 120, 100, 90]
    minimum: 0
    maximum: 500
  - name: assemblyCapacity
    type: array
    title: "Assembly Line Capacity"
    description: "Maximum items that can be assembled per time period"
    default: [90, 90, 90, 90, 90, 90]
    minimum: 1
    maximum: 200
  - name: qualityCapacity
    type: array
    title: "Quality Control Capacity"
    description: "Maximum items that can be quality checked per time period"
    default: [80, 80, 80, 80, 80, 80]
    minimum: 1
    maximum: 200
  - name: qualityRate
    type: number
    title: "Quality Pass Rate"
    description: "Percentage of items that pass quality control (0.0-1.0)"
    default: 0.95
    minimum: 0.1
    maximum: 1.0
  - name: productionRate
    type: number
    title: "Production Rate"
    description: "Base production rate per time period"
    default: 12
    minimum: 1
    maximum: 100
  - name: defectRate
    type: number
    title: "Defect Rate"
    description: "Percentage of items that become defective (0.0-1.0)"
    default: 0.05
    minimum: 0.0
    maximum: 0.5
  - name: telemetryRawMaterialsSource
    type: string
    title: "Telemetry raw materials source"
    description: "Optional file:// URI for raw material arrivals when replaying telemetry"
    default: ""

grid:
  bins: ${bins}
  binSize: ${binSize}
  binUnit: minutes

topology:
  nodes:
    - id: AssemblyLine
      kind: service
      semantics:
        arrivals: raw_materials
        served: assembly
        errors: defects
        processingTimeMsSum: assembly_processing_time_ms_sum
        servedCount: assembly
    - id: QualityControl
      kind: service
      semantics:
        arrivals: assembly
        served: quality_control
        errors: quality_rejects
        processingTimeMsSum: quality_processing_time_ms_sum
        servedCount: quality_control
    - id: PackagingStation
      kind: service
      semantics:
        arrivals: quality_control
        served: packaging
        errors: packaging_rejects
        processingTimeMsSum: packaging_processing_time_ms_sum
        servedCount: packaging
  edges:
    - id: edge1
      from: AssemblyLine:out
      to: QualityControl:in
    - id: edge2
      from: QualityControl:out
      to: PackagingStation:in

nodes:
  - id: raw_materials
    kind: const
    values: ${rawMaterialSchedule}
    source: ${telemetryRawMaterialsSource}

  - id: assembly_capacity
    kind: const
    values: ${assemblyCapacity}

  - id: quality_control_capacity
    kind: const
    values: ${qualityCapacity}

  - id: assembly
    kind: expr
    expr: "MIN(raw_materials, assembly_capacity)"

  - id: assembly_processing_time_ms_sum
    kind: expr
    expr: "assembly * 240"

  - id: quality_control
    kind: expr
    expr: "MIN(assembly * ${qualityRate}, quality_control_capacity)"

  - id: quality_processing_time_ms_sum
    kind: expr
    expr: "quality_control * 300"

  - id: quality_rejects
    kind: expr
    expr: "MAX(assembly - quality_control, 0)"

  - id: packaging
    kind: expr
    expr: "MIN(quality_control, ${productionRate} * 0.9)"

  - id: packaging_processing_time_ms_sum
    kind: expr
    expr: "packaging * 360"

  - id: packaging_rejects
    kind: expr
    expr: "MAX(quality_control - packaging, 0)"

  - id: defects
    kind: expr
    expr: "assembly * ${defectRate}"

outputs:
  - series: raw_materials
    as: raw_materials.csv
  - series: packaging
    as: finished_goods.csv
  - series: defects
    as: defects.csv
  - series: quality_control
    as: quality_passed.csv
  - series: packaging_rejects
    as: packaging_rejects.csv
  - series: quality_rejects
    as: quality_rejects.csv

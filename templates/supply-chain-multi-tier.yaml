# Multi-Tier Supply Chain - Template
# Complex supply chain with suppliers, distributors, retailers, and demand variability

metadata:
  title: 'Multi-Tier Supply Chain'
  description: 'Complex supply chain with suppliers, distributors, retailers, and demand variability'
  templateId: 'supply-chain-multi-tier'
  tags: [advanced, supply-chain, multi-tier, variability, logistics]
  parameters:
    - name: bins
      type: integer
      title: "Time Periods"
      description: "Number of time periods to simulate"
      defaultValue: 12
      minimum: 3
      maximum: 48
    - name: binMinutes
      type: integer
      title: "Minutes per Period"  
      description: "Duration of each time period"
      defaultValue: 60
      minimum: 15
      maximum: 480
    - name: demandPattern
      type: numberArray
      title: "Customer Demand Pattern"
      description: "Customer demand volume per time period"
      defaultValue: [80, 120, 160, 140, 100, 60]
      minimum: 0
      maximum: 5000
    - name: supplierCapacity
      type: numberArray
      title: "Supplier Capacity"
      description: "Supplier production capacity per time period"
      defaultValue: [200, 200, 200, 200, 200, 200]
      minimum: 1
      maximum: 5000
    - name: distributorCapacity
      type: numberArray
      title: "Distributor Capacity"
      description: "Distribution center capacity per time period"
      defaultValue: [150, 150, 150, 150, 150, 150]
      minimum: 1
      maximum: 5000
    - name: retailerCapacity
      type: numberArray
      title: "Retailer Capacity"
      description: "Retail outlet capacity per time period"
      defaultValue: [120, 120, 120, 120, 120, 120]
      minimum: 1
      maximum: 5000
    - name: bufferSize
      type: number
      title: "Buffer Size Multiplier"
      description: "Safety stock buffer as multiplier of demand"
      defaultValue: 1.2
      minimum: 1.0
      maximum: 3.0

schemaVersion: 1
grid:
  bins: {{bins}}
  binMinutes: {{binMinutes}}

nodes:
  # Customer demand (variable)
  - id: customer_demand
    kind: const
    values: {{demandPattern}}

  # Supplier capacity
  - id: supplier_capacity
    kind: const
    values: {{supplierCapacity}}

  # Distributor capacity
  - id: distributor_capacity
    kind: const
    values: {{distributorCapacity}}

  # Retailer capacity
  - id: retailer_capacity
    kind: const
    values: {{retailerCapacity}}

  # Items supplied
  - id: supplied_items
    kind: expr
    expr: "MIN(customer_demand * {{bufferSize}}, supplier_capacity)"

  # Items distributed
  - id: distributed_items
    kind: expr
    expr: "MIN(supplied_items, distributor_capacity)"

  # Items sold at retail
  - id: retail_sales
    kind: expr
    expr: "MIN(distributed_items, retailer_capacity)"

  # Unmet demand
  - id: unmet_demand
    kind: expr
    expr: "MAX(0, customer_demand - retail_sales)"

  # Supply chain efficiency
  - id: supply_efficiency
    kind: expr
    expr: "retail_sales / customer_demand"

outputs:
  - series: customer_demand
    as: demand.csv
  - series: retail_sales
    as: sales.csv
  - series: unmet_demand
    as: stockouts.csv
  - series: supply_efficiency
    as: efficiency.csv
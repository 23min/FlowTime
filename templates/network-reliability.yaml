# Network Reliability with Stochastic Failures - Template
# Demonstrates PMF nodes and RNG for probabilistic network behavior modeling

metadata:
  id: 'network-reliability'
  title: 'Network Reliability with Stochastic Failures'
  description: 'Demonstrates PMF nodes and RNG for probabilistic network behavior modeling'
  tags: [advanced, probabilistic, rng, network, stochastic]

parameters:
  - name: bins
    type: integer
    title: "Time Periods"
    description: "Number of time periods to simulate"
    default: 12
    minimum: 1
    maximum: 48
  - name: binSize
    type: integer
    title: "Period Duration"
    description: "Duration of each time period in minutes"
    default: 60
    minimum: 15
    maximum: 480
  - name: rngSeed
    type: integer
    title: "Random Number Generator Seed"
    description: "Seed for reproducible random behavior"
    default: 42
    minimum: 1
    maximum: 2147483647
  - name: baseLoad
    type: array
    title: "Base Request Load"
    description: "Expected requests per time period"
    default: [100, 120, 150, 180, 200, 190, 170, 160, 140, 130, 110, 105]
    minimum: 0
    maximum: 1000
  - name: serverBaseCapacity
    type: integer
    title: "Server Base Capacity"
    description: "Base server capacity before performance variations"
    default: 150
    minimum: 50
    maximum: 500

grid:
  bins: ${bins}
  binSize: ${binSize}
  binUnit: minutes

rng:
  kind: pcg32
  seed: ${rngSeed}

nodes:
  # Base request load (deterministic pattern)
  - id: base_requests
    kind: const
    values: ${baseLoad}
    
  # Network reliability (stochastic failures)
  - id: network_reliability
    kind: pmf
    pmf:
      values: [1.0, 0.95, 0.8, 0.6, 0.3]
      probabilities: [0.7, 0.2, 0.06, 0.03, 0.01]
      
  # Server performance variation (load-dependent capacity)
  - id: server_performance
    kind: pmf  
    pmf:
      values: [0.8, 0.9, 1.0, 1.1, 1.2]
      probabilities: [0.05, 0.15, 0.6, 0.15, 0.05]
      
  # Database connection reliability
  - id: database_reliability
    kind: pmf
    pmf:
      values: [1.0, 0.9, 0.7, 0.5]
      probabilities: [0.85, 0.1, 0.04, 0.01]
    
  # Requests that reach the server (after network failures)
  - id: network_requests
    kind: expr
    expression: "base_requests * network_reliability"
    
  # Available server capacity (with performance variations)
  - id: server_capacity
    kind: expr
    expression: "${serverBaseCapacity} * server_performance"
    
  # Requests that can be processed by server
  - id: server_processed
    kind: expr
    expression: "MIN(network_requests, server_capacity)"
    
  # Requests that successfully complete (after database failures)
  - id: successful_requests
    kind: expr
    expression: "server_processed * database_reliability"
    
  # Failed requests due to network issues
  - id: network_failures
    kind: expr
    expression: "base_requests - network_requests"
    
  # Failed requests due to server capacity
  - id: server_failures
    kind: expr
    expression: "network_requests - server_processed"
    
  # Failed requests due to database issues
  - id: database_failures
    kind: expr
    expression: "server_processed - successful_requests"
    
  # Overall system reliability
  - id: system_reliability
    kind: expr
    expression: "successful_requests / base_requests"

outputs:
  - id: base_requests
    source: base_requests
    filename: base_requests.csv
    description: "Original incoming requests"
  - id: successful_requests
    source: successful_requests
    filename: successful_requests.csv
    description: "Successfully processed requests"
  - id: network_failures
    source: network_failures
    filename: network_failures.csv
    description: "Requests lost due to network issues"
  - id: server_failures
    source: server_failures
    filename: server_failures.csv
    description: "Requests lost due to server capacity"
  - id: database_failures
    source: database_failures
    filename: database_failures.csv
    description: "Requests lost due to database issues"
  - id: system_reliability
    source: system_reliability
    filename: system_reliability.csv
    description: "Overall system success rate"
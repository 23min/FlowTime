@host = http://localhost:8080
@captureDir = /workspaces/flowtime-vnext/examples/time-travel/it-system-telemetry
@runsRoot = /workspaces/flowtime-vnext/data/runs
# Ensure FlowTime.API is running with FLOWTIME_DATA_DIR=/workspaces/flowtime-vnext/data.
# The samples below use the it-system-microservices template plus the deterministic capture bundle under examples/time-travel/it-system-telemetry (manifest included).

### 1. Service health (confirm API is reachable)
GET {{host}}/v1/healthz
Accept: application/json

################################################################################
# Run orchestration workflows
################################################################################
### 2. Dry-run telemetry orchestration (no files written)
# @name dryRunTelemetry
POST {{host}}/v1/runs
Content-Type: application/json

{
  "templateId": "it-system-microservices",
  "mode": "telemetry",
  "telemetry": {
    "captureDirectory": "{{captureDir}}",
    "bindings": {
      "telemetryRequestsSource": "LoadBalancer_arrivals.csv"
    }
  },
  "options": {
    "dryRun": true,
    "deterministicRunId": true
  }
}
# 200 OK
# {
#   "isDryRun": true,
#   "plan": {
#     "templateId": "it-system-microservices",
#     "mode": "telemetry",
#     "outputRoot": "/workspaces/flowtime-vnext/data/runs",
#     "captureDirectory": "/workspaces/flowtime-vnext/examples/time-travel/it-system-telemetry",
#     "deterministicRunId": true,
#     "requestedRunId": null,
#     "parameters": {
#       "telemetryRequestsSource": "file:///workspaces/flowtime-vnext/examples/time-travel/it-system-telemetry/LoadBalancer_arrivals.csv"
#     },
#     "telemetryBindings": {
#       "telemetryRequestsSource": "OrderService_arrivals.csv"
#     },
#     "files": [
#       {
#         "nodeId": "OrderService",
#         "metric": "Arrivals",
#         "path": "OrderService_arrivals.csv"
#       },
#       {
#         "nodeId": "PaymentService",
#         "metric": "Served",
#         "path": "PaymentService_served.csv"
#       },
#       ...
#     ],
#     "warnings": []
#   },
#   "warnings": []
# }

### 3. Create telemetry run (writes canonical bundle)
# @name createTelemetryRun
POST {{host}}/v1/runs
Content-Type: application/json

{
  "templateId": "it-system-microservices",
  "mode": "telemetry",
  "telemetry": {
    "captureDirectory": "{{captureDir}}",
    "bindings": {
      "telemetryRequestsSource": "LoadBalancer_arrivals.csv"
    }
  },
  "options": {
    "deterministicRunId": true,
    "overwriteExisting": true
  }
}
# 201 Created
# {
#   "isDryRun": false,
#   "metadata": {
#     "runId": "run_it-system-microservices_17d0f0c6",
#     "templateId": "it-system-microservices",
#     "templateTitle": "IT System with Microservices",
#     "templateVersion": "1.0.0",
#     "mode": "telemetry",
#     "provenanceHash": "sha256:...",
#     "telemetrySourcesResolved": true,
#     "schema": {
#       "id": "time-travel/v1",
#       "version": "1",
#       "hash": "sha256:..."
#     },
#     "storage": {
#       "modelPath": "/workspaces/flowtime-vnext/data/runs/run_it-system-microservices_17d0f0c6/model/model.yaml",
#       "metadataPath": "/workspaces/flowtime-vnext/data/runs/run_it-system-microservices_17d0f0c6/model/metadata.json",
#       "provenancePath": "/workspaces/flowtime-vnext/data/runs/run_it-system-microservices_17d0f0c6/model/provenance.json"
#     }
#   },
#   "warnings": []
# }

### 3b. Create simulation run (no telemetry capture required)
# Uses the built-in transportation template to generate synthetic series via FlowTime.Sim
POST {{host}}/v1/runs
Content-Type: application/json

{
  "templateId": "transportation-basic",
  "mode": "simulation",
  "parameters": {
    "bins": 6,
    "binSize": 60
  },
  "options": {
    "deterministicRunId": true,
    "overwriteExisting": true
  }
}
# 201 Created
# {
#   "isDryRun": false,
#   "metadata": {
#     "runId": "run_deterministic_...",
#     "templateId": "transportation-basic",
#     "mode": "simulation",
#     "telemetrySourcesResolved": true,
#     "storage": {
#       "modelPath": "{{runsRoot}}/run_deterministic_.../model/model.yaml",
#       "metadataPath": "{{runsRoot}}/run_deterministic_.../model/metadata.json",
#       "provenancePath": null
#     }
#   },
#   "warnings": [],
#   "canReplay": true
# }

### 4. List available runs (created via API or CLI)
GET {{host}}/v1/runs
Accept: application/json
# 200 OK
# {
#   "items": [
#     {
#       "runId": "run_it-system-microservices_17d0f0c6",
#       "templateId": "it-system-microservices",
#       "templateTitle": "IT System with Microservices",
#       "templateVersion": "1.0.0",
#       "mode": "telemetry",
#       "createdUtc": "2025-10-20T12:34:56.0000000Z",
#       "warningCount": 0
#     }
#   ],
#   "totalCount": 1
# }

### 4b. Filtered listing with pagination (mode + warnings)
GET {{host}}/v1/runs?mode=telemetry&hasWarnings=false&page=1&pageSize=10
Accept: application/json
# 200 OK (first page, filtered by telemetry runs without warnings)

### 5. Inspect run metadata (mirrors /state envelope)
GET {{host}}/v1/runs/{{createTelemetryRun.response.body.$.metadata.runId}}
Accept: application/json
# 200 OK (same shape as create response without isDryRun)

### 6. Optional: trigger state playback (run must exist)
GET {{host}}/v1/runs/{{createTelemetryRun.response.body.$.metadata.runId}}/state?binIndex=0
Accept: application/json
# 200 OK (the bundled it-system template now includes complete semantics).
# 409 Conflict only appears when custom templates omit required bindings (for example, a `service` node without `semantics.errors`).

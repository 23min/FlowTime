@using System.Collections.Generic
@using FlowTime.UI.Components.Topology
@inherits TopologyCanvasBase

@if (HasVisibleNodes)
{
    <div class="topology-canvas-host" @onpointerleave="OnNodePointerLeave">
        <canvas @ref="canvasRef"
                class="topology-canvas"
                role="presentation">
        </canvas>
        <div class="topology-node-layer">
            @foreach (var proxy in NodeProxies)
            {
                <button type="button"
                        class="topology-node-proxy"
                        data-node-id="@proxy.Id"
                        data-focused="@(proxy.IsFocused ? "true" : "false")"
                        style="@proxy.Style"
                        aria-label="@proxy.AriaLabel"
                        @onclick="() => SelectNode(proxy.Id)"
                        @onmouseenter="() => HoverNode(proxy.Id)"
                        @onmouseleave="OnNodeHoverLeave"
                        @onfocus="() => SelectNode(proxy.Id)"
                        @onblur="OnNodeBlur"
                        @onkeydown="(args) => OnNodeKeyDown(args, proxy.Id)"
                        @onkeydown:preventDefault
                        >
                    <span class="visually-hidden">@proxy.AriaLabel</span>
                </button>
            }

            @if (!string.IsNullOrEmpty(SelectedNodeId))
            {
                <button type="button"
                        class="topology-node-inspector-toggle"
                        data-node-id="@SelectedNodeId"
                        title="View @SelectedNodeId details"
                        @onclick="() => OpenInspector(SelectedNodeId!)"
                        @onclick:stopPropagation>
                    <span class="topology-node-inspector-toggle__bars" aria-hidden="true">
                        <span class="bar bar-1"></span>
                        <span class="bar bar-2"></span>
                        <span class="bar bar-3"></span>
                        <span class="dot dot-1"></span>
                        <span class="dot dot-2"></span>
                        <span class="dot dot-3"></span>
                    </span>
                    <span class="visually-hidden">Open details for @SelectedNodeId</span>
                </button>
            }
        </div>
    </div>
}
else if (HasSourceGraph)
{
    <div class="topology-empty-state" data-testid="topology-filtered-empty">
        <p>
            Adjust the feature bar filters to include additional nodes in this view.
        </p>
    </div>
}
else
{
    <div class="topology-empty-state" data-testid="topology-empty">
        <p>
            Select a run to render its topology and live bin metrics.
        </p>
    </div>
}

@code {
}

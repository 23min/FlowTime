@using System.Collections.Generic
@using FlowTime.UI.Components.Topology
@inherits TopologyCanvasBase

@if (HasVisibleNodes)
{
    <div class="topology-canvas-host">
        <canvas @ref="canvasRef"
                class="topology-canvas"
                role="presentation">
        </canvas>
        <div class="topology-node-layer">
            @foreach (var proxy in NodeProxies)
            {
                <button type="button"
                        class="topology-node-proxy"
                        data-node-id="@proxy.Id"
                        data-focused="@(proxy.IsFocused ? "true" : "false")"
                        style="@proxy.Style"
                        aria-label="@proxy.AriaLabel"
                        @onclick="() => SelectNode(proxy.Id)"
                        @onmouseenter="() => HoverNode(proxy.Id)"
                        @onfocus="() => SelectNode(proxy.Id)"
                        @onblur="OnNodeBlur"
                        @onkeydown="(args) => OnNodeKeyDown(args, proxy.Id)"
                        @onkeydown:preventDefault
                        >
                    <span class="visually-hidden">@proxy.AriaLabel</span>
                </button>
            }
        </div>
    </div>
}
else if (HasSourceGraph)
{
    <div class="topology-empty-state" data-testid="topology-filtered-empty">
        <p>
            Adjust the feature bar filters to include additional nodes in this view.
        </p>
    </div>
}
else
{
    <div class="topology-empty-state" data-testid="topology-empty">
        <p>
            Select a run to render its topology and live bin metrics.
        </p>
    </div>
}

@code {
}
